(function(){RequireJS.define("js/student_account/emailoptin",["jquery","jquery.cookie"],function(e){var t={urls:{emailOptInUrl:"/user_api/v1/preferences/email_opt_in/"},headers:{"X-CSRFToken":e.cookie("csrftoken")},setPreference:function(t,i){return e.ajax({url:this.urls.emailOptInUrl,type:"POST",data:{course_id:t,email_opt_in:i},headers:this.headers})}};return t})}).call(this,define||RequireJS.define),function(){RequireJS.define("js/student_account/enrollment",["jquery","jquery.cookie"],function(e){var t={urls:{baskets:"/api/commerce/v0/baskets/"},headers:{"X-CSRFToken":e.cookie("csrftoken")},enroll:function(t,i){var n={course_id:t},r=JSON.stringify(n);e.ajax({url:this.urls.baskets,type:"POST",contentType:"application/json; charset=utf-8",data:r,headers:this.headers,context:this}).fail(function(e){var t=JSON.parse(e.responseText);403===e.status&&t.user_message_url?this.redirect(t.user_message_url):i&&this.redirect(i)}).done(function(){i&&this.redirect(i)})},redirect:function(e){window.location.href=e}};return t})}.call(this,define||RequireJS.define),function(){RequireJS.define("js/student_account/shoppingcart",["jquery","jquery.cookie"],function(e){var t={urls:{viewCart:"/shoppingcart/",addCourse:"/shoppingcart/add/course/"},headers:{"X-CSRFToken":e.cookie("csrftoken")},addCourseToCart:function(t){e.ajax({url:this.urls.addCourse+t+"/",type:"POST",data:{},headers:this.headers,context:this}).always(function(){this.redirect(this.urls.viewCart)})},redirect:function(e){window.location.href=e}};return t})}.call(this,define||RequireJS.define),function(){RequireJS.define("js/student_account/views/FinishAuthView",["jquery","underscore","backbone","gettext","js/student_account/emailoptin","js/student_account/enrollment","js/student_account/shoppingcart"],function(e,t,i,n,r,s,o){var c=i.View.extend({el:"#finish-auth-status",urls:{finishAuth:"/account/finish_auth",defaultNextUrl:"/dashboard",payment:"/verify_student/start-flow/",trackSelection:"/course_modes/choose/"},initialize:function(){var t={next:e.url("?next"),enrollmentAction:e.url("?enrollment_action"),courseId:e.url("?course_id"),courseMode:e.url("?course_mode"),emailOptIn:e.url("?email_opt_in")};for(var i in t)t[i]&&(t[i]=decodeURIComponent(t[i]));this.courseId=t.courseId,this.enrollmentAction=t.enrollmentAction,this.courseMode=t.courseMode,this.emailOptIn=t.emailOptIn,this.nextUrl=this.urls.defaultNextUrl,t.next&&(window.isExternal(t.next)||(this.nextUrl=t.next))},render:function(){try{var e=t.bind(this.enrollment,this);this.checkEmailOptIn(e)}catch(i){this.updateTaskDescription(n("Error")+": "+i.message),this.redirect(this.nextUrl)}},updateTaskDescription:function(e){console.log(e)},checkEmailOptIn:function(e){"true"!==this.emailOptIn&&"false"!==this.emailOptIn||!this.enrollmentAction?e():(this.updateTaskDescription(n("Saving your email preference")),r.setPreference(this.courseId,this.emailOptIn).always(e))},enrollment:function(){var e=this.nextUrl;if("enroll"===this.enrollmentAction&&this.courseId){this.updateTaskDescription(n("Enrolling you in the selected course"));var t=decodeURIComponent(this.courseId);this.courseMode?"honor"===this.courseMode||"audit"===this.courseMode||(e=this.urls.payment+t+"/"):e=this.urls.trackSelection+t+"/",s.enroll(t,e)}else"add_to_cart"===this.enrollmentAction&&this.courseId?(this.updateTaskDescription(n("Adding the selected course to your cart")),o.addCourseToCart(this.courseId)):this.redirect(e)},redirect:function(e){this.updateTaskDescription(n("Loading your courses")),window.location.replace(e)}});return c})}.call(this,define||RequireJS.define),function(){RequireJS.define("js/student_account/views/finish_auth_factory",["jquery","underscore","backbone","js/student_account/views/FinishAuthView","utility"],function(e,t,i,n){return function(){var e=new n({});e.render()}})}.call(this,define||RequireJS.define);