/**
 * @version: 1.0 Alpha-1
 * @author: Coolite Inc. http://www.coolite.com/
 * @date: 2008-05-13
 * @copyright: Copyright (c) 2006-2008, Coolite Inc. (http://www.coolite.com/). All rights reserved.
 * @license: Licensed under The MIT License. See license.txt and http://www.datejs.com/license/.
 * @website: http://www.datejs.com/
 */

!function(){RequireJS.define("js/discovery/models/course_card",["backbone"],function(e){return e.Model.extend({defaults:{modes:[],course:"",enrollment_start:"",number:"",content:{overview:"",display_name:"",number:""},start:"",image_url:"",org:"",id:""}})})}(define||RequireJS.define),function(){RequireJS.define("js/discovery/models/facet_option",["backbone"],function(e){return e.Model.extend({idAttribute:"term",defaults:{facet:"",term:"",count:0,selected:!1}})})}(define||RequireJS.define),function(){RequireJS.define("js/discovery/models/course_discovery",["underscore","backbone","js/discovery/models/course_card","js/discovery/models/facet_option"],function(e,t,n,i){return t.Model.extend({url:"/search/course_discovery/",jqhxr:null,defaults:{totalCount:0,latestCount:0},initialize:function(){this.courseCards=new t.Collection([],{model:n}),this.facetOptions=new t.Collection([],{model:i})},parse:function(t){var n=t.results||[],i=t.facets||{};this.courseCards.add(e.pluck(n,"data")),this.set({totalCount:t.total,latestCount:n.length});var r=this.facetOptions;e(i).each(function(t,n){e(t.terms).each(function(e,t){r.add({facet:n,term:t,count:e},{merge:!0})})})},reset:function(){this.set({totalCount:0,latestCount:0}),this.courseCards.reset(),this.facetOptions.reset()},latest:function(){return this.courseCards.last(this.get("latestCount"))}})})}(define||RequireJS.define),function(){RequireJS.define("js/discovery/models/filter",["backbone"],function(e){return e.Model.extend({idAttribute:"type",defaults:{type:"search_query",query:"",name:""}})})}(define||RequireJS.define),function(){RequireJS.define("js/discovery/collections/filters",["backbone","js/discovery/models/filter"],function(e,t){return e.Collection.extend({model:t,getTerms:function(){return this.reduce(function(e,t){return e[t.id]=t.get("query"),e},{})}})})}(define||RequireJS.define),function(){RequireJS.define("js/discovery/models/search_state",["underscore","backbone","js/discovery/models/course_discovery","js/discovery/collections/filters"],function(e,t,n){return t.Model.extend({page:0,pageSize:20,searchTerm:"",terms:{},jqhxr:null,initialize:function(){this.discovery=new n,this.listenTo(this.discovery,"sync",this.onSync,this),this.listenTo(this.discovery,"error",this.onError,this)},performSearch:function(e,t){this.reset(),this.searchTerm=e,t&&(this.terms=t),this.sendQuery(this.buildQuery(0))},refineSearch:function(e){this.reset(),this.terms=e,this.sendQuery(this.buildQuery(0))},loadNextPage:function(){this.hasNextPage()&&this.sendQuery(this.buildQuery(this.page+1))},hasNextPage:function(){var e=this.discovery.get("totalCount");return e-(this.page+1)*this.pageSize>0},sendQuery:function(e){return this.jqhxr&&this.jqhxr.abort(),this.jqhxr=this.discovery.fetch({type:"POST",data:e}),this.jqhxr},buildQuery:function(t){var n={search_string:this.searchTerm,page_size:this.pageSize,page_index:t};return e.extend(n,this.terms),n},reset:function(){this.discovery.reset(),this.page=0},onError:function(e,t){"abort"!==t.statusText&&this.trigger("error")},onSync:function(t,n,i){var r=this.discovery.get("totalCount"),s=this.searchTerm;0===i.data.page_index?0===r?(this.cachedDiscovery().done(function(e){this.discovery.courseCards.reset(e.courseCards.toJSON()),this.discovery.facetOptions.reset(e.facetOptions.toJSON()),this.discovery.set("latestCount",e.get("latestCount")),this.trigger("search",s,r)}),this.searchTerm="",this.terms={}):(e.each(this.terms,function(e,t){if("search_query"!==t){var n=this.discovery.facetOptions.findWhere({facet:t,term:e});n&&n.set("selected",!0)}},this),this.trigger("search",this.searchTerm,r)):(this.page=i.data.page_index,this.trigger("next"))},cachedDiscovery:function(){var e=$.Deferred(),t=this;return this.cached?e.resolveWith(this,[this.cached]):(this.cached=new n,this.cached.fetch({type:"POST",data:{search_string:"",page_size:this.pageSize,page_index:0},success:function(n){e.resolveWith(t,[n])}})),e.promise()}})})}(define||RequireJS.define),function(){RequireJS.define("js/discovery/views/search_form",["jquery","backbone","gettext"],function(e,t,n){return t.View.extend({el:"#discovery-form",events:{"submit form":"submitForm"},initialize:function(){this.$searchField=this.$el.find("input"),this.$searchButton=this.$el.find("button"),this.$message=this.$el.find("#discovery-message"),this.$loadingIndicator=this.$el.find("#loading-indicator")},submitForm:function(e){e.preventDefault(),this.doSearch()},doSearch:function(t){void 0!==t?this.$searchField.val(t):t=this.$searchField.val(),this.trigger("search",e.trim(t))},clearSearch:function(){this.$searchField.val("")},showLoadingIndicator:function(){this.$loadingIndicator.removeClass("hidden")},hideLoadingIndicator:function(){this.$loadingIndicator.addClass("hidden")},showFoundMessage:function(e){var t=ngettext("Viewing %s course","Viewing %s courses",e);this.$message.html(interpolate(t,[e]))},showNotFoundMessage:function(e){var t=interpolate(n('We couldn\'t find any results for "%s".'),[_.escape(e)]);this.$message.html(t),this.clearSearch()},showErrorMessage:function(){this.$message.html(n("There was an error, try searching again."))}})})}(define||RequireJS.define),Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|aft(er)?|from|hence)/i,subtract:/^(\-|bef(ore)?|ago)/i,yesterday:/^yes(terday)?/i,today:/^t(od(ay)?)?/i,tomorrow:/^tom(orrow)?/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^mn|min(ute)?s?/i,hour:/^h(our)?s?/i,week:/^w(eek)?s?/i,month:/^m(onth)?s?/i,day:/^d(ay)?s?/i,year:/^y(ear)?s?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]},function(){var e=Date,t=e.prototype,n=e.CultureInfo,i=function(e,t){return t||(t=2),("000"+e).slice(-1*t)};t.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},t.setTimeToNow=function(){var e=new Date;return this.setHours(e.getHours()),this.setMinutes(e.getMinutes()),this.setSeconds(e.getSeconds()),this.setMilliseconds(e.getMilliseconds()),this},e.today=function(){return(new Date).clearTime()},e.compare=function(e,t){if(isNaN(e)||isNaN(t))throw new Error(e+" - "+t);if(e instanceof Date&&t instanceof Date)return t>e?-1:e>t?1:0;throw new TypeError(e+" - "+t)},e.equals=function(e,t){return 0===e.compareTo(t)},e.getDayNumberFromName=function(e){for(var t=n.dayNames,i=n.abbreviatedDayNames,r=n.shortestDayNames,s=e.toLowerCase(),o=0;o<t.length;o++)if(t[o].toLowerCase()==s||i[o].toLowerCase()==s||r[o].toLowerCase()==s)return o;return-1},e.getMonthNumberFromName=function(e){for(var t=n.monthNames,i=n.abbreviatedMonthNames,r=e.toLowerCase(),s=0;s<t.length;s++)if(t[s].toLowerCase()==r||i[s].toLowerCase()==r)return s;return-1},e.isLeapYear=function(e){return e%4===0&&e%100!==0||e%400===0},e.getDaysInMonth=function(t,n){return[31,e.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][n]},e.getTimezoneAbbreviation=function(e){for(var t=n.timezones,i=0;i<t.length;i++)if(t[i].offset===e)return t[i].name;return null},e.getTimezoneOffset=function(e){for(var t=n.timezones,i=0;i<t.length;i++)if(t[i].name===e.toUpperCase())return t[i].offset;return null},t.clone=function(){return new Date(this.getTime())},t.compareTo=function(e){return Date.compare(this,e)},t.equals=function(e){return Date.equals(this,e||new Date)},t.between=function(e,t){return this.getTime()>=e.getTime()&&this.getTime()<=t.getTime()},t.isAfter=function(e){return 1===this.compareTo(e||new Date)},t.isBefore=function(e){return-1===this.compareTo(e||new Date)},t.isToday=function(){return this.isSameDay(new Date)},t.isSameDay=function(e){return this.clone().clearTime().equals(e.clone().clearTime())},t.addMilliseconds=function(e){return this.setMilliseconds(this.getMilliseconds()+e),this},t.addSeconds=function(e){return this.addMilliseconds(1e3*e)},t.addMinutes=function(e){return this.addMilliseconds(6e4*e)},t.addHours=function(e){return this.addMilliseconds(36e5*e)},t.addDays=function(e){return this.setDate(this.getDate()+e),this},t.addWeeks=function(e){return this.addDays(7*e)},t.addMonths=function(t){var n=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+t),this.setDate(Math.min(n,e.getDaysInMonth(this.getFullYear(),this.getMonth()))),this},t.addYears=function(e){return this.addMonths(12*e)},t.add=function(e){if("number"==typeof e)return this._orient=e,this;var t=e;return t.milliseconds&&this.addMilliseconds(t.milliseconds),t.seconds&&this.addSeconds(t.seconds),t.minutes&&this.addMinutes(t.minutes),t.hours&&this.addHours(t.hours),t.weeks&&this.addWeeks(t.weeks),t.months&&this.addMonths(t.months),t.years&&this.addYears(t.years),t.days&&this.addDays(t.days),this};var r,s,o;t.getWeek=function(){var e,t,n,i,a,u,h,c,d,l;return r=r?r:this.getFullYear(),s=s?s:this.getMonth()+1,o=o?o:this.getDate(),2>=s?(e=r-1,t=(e/4|0)-(e/100|0)+(e/400|0),n=((e-1)/4|0)-((e-1)/100|0)+((e-1)/400|0),d=t-n,a=0,u=o-1+31*(s-1)):(e=r,t=(e/4|0)-(e/100|0)+(e/400|0),n=((e-1)/4|0)-((e-1)/100|0)+((e-1)/400|0),d=t-n,a=d+1,u=o+(153*(s-3)+2)/5+58+d),h=(e+t)%7,i=(u+h-a)%7,c=u+3-i|0,l=0>c?53-((h-d)/5|0):c>364+d?1:(c/7|0)+1,r=s=o=null,l},t.getISOWeek=function(){return r=this.getUTCFullYear(),s=this.getUTCMonth()+1,o=this.getUTCDate(),i(this.getWeek())},t.setWeek=function(e){return this.moveToDayOfWeek(1).addWeeks(e-this.getWeek())},e._validate=function(e,t,n,i){if("undefined"==typeof e)return!1;if("number"!=typeof e)throw new TypeError(e+" is not a Number.");if(t>e||e>n)throw new RangeError(e+" is not a valid value for "+i+".");return!0},e.validateMillisecond=function(t){return e._validate(t,0,999,"millisecond")},e.validateSecond=function(t){return e._validate(t,0,59,"second")},e.validateMinute=function(t){return e._validate(t,0,59,"minute")},e.validateHour=function(t){return e._validate(t,0,23,"hour")},e.validateDay=function(t,n,i){return e._validate(t,1,e.getDaysInMonth(n,i),"day")},e.validateMonth=function(t){return e._validate(t,0,11,"month")},e.validateYear=function(t){return e._validate(t,0,9999,"year")},t.set=function(t){return e.validateMillisecond(t.millisecond)&&this.addMilliseconds(t.millisecond-this.getMilliseconds()),e.validateSecond(t.second)&&this.addSeconds(t.second-this.getSeconds()),e.validateMinute(t.minute)&&this.addMinutes(t.minute-this.getMinutes()),e.validateHour(t.hour)&&this.addHours(t.hour-this.getHours()),e.validateMonth(t.month)&&this.addMonths(t.month-this.getMonth()),e.validateYear(t.year)&&this.addYears(t.year-this.getFullYear()),e.validateDay(t.day,this.getFullYear(),this.getMonth())&&this.addDays(t.day-this.getDate()),t.timezone&&this.setTimezone(t.timezone),t.timezoneOffset&&this.setTimezoneOffset(t.timezoneOffset),t.week&&e._validate(t.week,0,53,"week")&&this.setWeek(t.week),this},t.moveToFirstDayOfMonth=function(){return this.set({day:1})},t.moveToLastDayOfMonth=function(){return this.set({day:e.getDaysInMonth(this.getFullYear(),this.getMonth())})},t.moveToNthOccurrence=function(e,t){var n=0;if(t>0)n=t-1;else if(-1===t)return this.moveToLastDayOfMonth(),this.getDay()!==e&&this.moveToDayOfWeek(e,-1),this;return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(e,1).addWeeks(n)},t.moveToDayOfWeek=function(e,t){var n=(e-this.getDay()+7*(t||1))%7;return this.addDays(0===n?n+=7*(t||1):n)},t.moveToMonth=function(e,t){var n=(e-this.getMonth()+12*(t||1))%12;return this.addMonths(0===n?n+=12*(t||1):n)},t.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/864e5)+1},t.getTimezone=function(){return e.getTimezoneAbbreviation(this.getUTCOffset())},t.setTimezoneOffset=function(e){var t=this.getTimezoneOffset(),n=-6*Number(e)/10;return this.addMinutes(n-t)},t.setTimezone=function(t){return this.setTimezoneOffset(e.getTimezoneOffset(t))},t.hasDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset()},t.isDaylightSavingTime=function(){return this.hasDaylightSavingTime()&&(new Date).getTimezoneOffset()===Date.today().set({month:6,day:1}).getTimezoneOffset()},t.getUTCOffset=function(){var e,t=-10*this.getTimezoneOffset()/6;return 0>t?(e=(t-1e4).toString(),e.charAt(0)+e.substr(2)):(e=(t+1e4).toString(),"+"+e.substr(1))},t.getElapsed=function(e){return(e||new Date)-this},t.toISOString||(t.toISOString=function(){function e(e){return 10>e?"0"+e:e}return'"'+this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+'Z"'}),"undefined"==typeof t._toString&&(t._toString=t.toString),t.toString=function(e){var t=this;if(e&&1==e.length){var r=n.formatPatterns;switch(t.t=t.toString,e){case"d":return t.t(r.shortDate);case"D":return t.t(r.longDate);case"F":return t.t(r.fullDateTime);case"m":return t.t(r.monthDay);case"r":return t.t(r.rfc1123);case"s":return t.t(r.sortableDateTime);case"t":return t.t(r.shortTime);case"T":return t.t(r.longTime);case"u":return t.t(r.universalSortableDateTime);case"y":return t.t(r.yearMonth)}}var s=function(e){switch(1*e){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}};return e?e.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(e){if("\\"===e.charAt(0))return e.replace("\\","");switch(t.h=t.getHours,e){case"hh":return i(t.h()<13?0===t.h()?12:t.h():t.h()-12);case"h":return t.h()<13?0===t.h()?12:t.h():t.h()-12;case"HH":return i(t.h());case"H":return t.h();case"mm":return i(t.getMinutes());case"m":return t.getMinutes();case"ss":return i(t.getSeconds());case"s":return t.getSeconds();case"yyyy":return i(t.getFullYear(),4);case"yy":return i(t.getFullYear());case"dddd":return n.dayNames[t.getDay()];case"ddd":return n.abbreviatedDayNames[t.getDay()];case"dd":return i(t.getDate());case"d":return t.getDate();case"MMMM":return n.monthNames[t.getMonth()];case"MMM":return n.abbreviatedMonthNames[t.getMonth()];case"MM":return i(t.getMonth()+1);case"M":return t.getMonth()+1;case"t":return t.h()<12?n.amDesignator.substring(0,1):n.pmDesignator.substring(0,1);case"tt":return t.h()<12?n.amDesignator:n.pmDesignator;case"S":return s(t.getDate());default:return e}}):this._toString()}}(),function(){var e=Date,t=e.prototype,n=e.CultureInfo,i=Number.prototype;t._orient=1,t._nth=null,t._is=!1,t._same=!1,t._isSecond=!1,i._dateElement="day",t.next=function(){return this._orient=1,this},e.next=function(){return e.today().next()},t.last=t.prev=t.previous=function(){return this._orient=-1,this},e.last=e.prev=e.previous=function(){return e.today().last()},t.is=function(){return this._is=!0,this},t.same=function(){return this._same=!0,this._isSecond=!1,this},t.today=function(){return this.same().day()},t.weekday=function(){return this._is?(this._is=!1,!this.is().sat()&&!this.is().sun()):!1},t.at=function(t){return"string"==typeof t?e.parse(this.toString("d")+" "+t):this.set(t)},i.fromNow=i.after=function(e){var t={};return t[this._dateElement]=this,(e?e.clone():new Date).add(t)},i.ago=i.before=function(e){var t={};return t[this._dateElement]=-1*this,(e?e.clone():new Date).add(t)};var r,s="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),o="january february march april may june july august september october november december".split(/\s/),a="Millisecond Second Minute Hour Day Week Month Year".split(/\s/),u="Milliseconds Seconds Minutes Hours Date Week Month FullYear".split(/\s/),h="final first second third fourth fifth".split(/\s/);t.toObject=function(){for(var e={},t=0;t<a.length;t++)e[a[t].toLowerCase()]=this["get"+u[t]]();return e},e.fromObject=function(e){return e.week=null,Date.today().set(e)};for(var c=function(t){return function(){if(this._is)return this._is=!1,this.getDay()==t;if(null!==this._nth){this._isSecond&&this.addSeconds(-1*this._orient),this._isSecond=!1;var n=this._nth;this._nth=null;var i=this.clone().moveToLastDayOfMonth();if(this.moveToNthOccurrence(t,n),this>i)throw new RangeError(e.getDayName(t)+" does not occur "+n+" times in the month of "+e.getMonthName(i.getMonth())+" "+i.getFullYear()+".");return this}return this.moveToDayOfWeek(t,this._orient)}},d=function(t){return function(){var i=e.today(),r=t-i.getDay();return 0===t&&1===n.firstDayOfWeek&&0!==i.getDay()&&(r+=7),i.addDays(r)}},l=0;l<s.length;l++)e[s[l].toUpperCase()]=e[s[l].toUpperCase().substring(0,3)]=l,e[s[l]]=e[s[l].substring(0,3)]=d(l),t[s[l]]=t[s[l].substring(0,3)]=c(l);for(var f=function(e){return function(){return this._is?(this._is=!1,this.getMonth()===e):this.moveToMonth(e,this._orient)}},m=function(t){return function(){return e.today().set({month:t,day:1})}},y=0;y<o.length;y++)e[o[y].toUpperCase()]=e[o[y].toUpperCase().substring(0,3)]=y,e[o[y]]=e[o[y].substring(0,3)]=m(y),t[o[y]]=t[o[y].substring(0,3)]=f(y);for(var g=function(e){return function(){if(this._isSecond)return this._isSecond=!1,this;if(this._same){this._same=this._is=!1;for(var t=this.toObject(),n=(arguments[0]||new Date).toObject(),i="",r=e.toLowerCase(),s=a.length-1;s>-1;s--){if(i=a[s].toLowerCase(),t[i]!=n[i])return!1;if(r==i)break}return!0}return"s"!=e.substring(e.length-1)&&(e+="s"),this["add"+e](this._orient)}},p=function(e){return function(){return this._dateElement=e,this}},v=0;v<a.length;v++)r=a[v].toLowerCase(),t[r]=t[r+"s"]=g(a[v]),i[r]=i[r+"s"]=p(r);t._ss=g("Second");for(var M=function(e){return function(t){return this._same?this._ss(arguments[0]):t||0===t?this.moveToNthOccurrence(t,e):(this._nth=e,2!==e||void 0!==t&&null!==t?this:(this._isSecond=!0,this.addSeconds(this._orient)))}},w=0;w<h.length;w++)t[h[w]]=M(0===w?-1:w)}(),function(){Date.Parsing={Exception:function(e){this.message="Parse error at '"+e.substring(0,10)+" ...'"}};for(var e=Date.Parsing,t=e.Operators={rtoken:function(t){return function(n){var i=n.match(t);if(i)return[i[0],n.substring(i[0].length)];throw new e.Exception(n)}},token:function(){return function(e){return t.rtoken(new RegExp("^s*"+e+"s*"))(e)}},stoken:function(e){return t.rtoken(new RegExp("^"+e))},until:function(e){return function(t){for(var n=[],i=null;t.length;){try{i=e.call(this,t)}catch(r){n.push(i[0]),t=i[1];continue}break}return[n,t]}},many:function(e){return function(t){for(var n=[],i=null;t.length;){try{i=e.call(this,t)}catch(r){return[n,t]}n.push(i[0]),t=i[1]}return[n,t]}},optional:function(e){return function(t){var n=null;try{n=e.call(this,t)}catch(i){return[null,t]}return[n[0],n[1]]}},not:function(t){return function(n){try{t.call(this,n)}catch(i){return[null,n]}throw new e.Exception(n)}},ignore:function(e){return e?function(t){var n=null;return n=e.call(this,t),[null,n[1]]}:null},product:function(){for(var e=arguments[0],n=Array.prototype.slice.call(arguments,1),i=[],r=0;r<e.length;r++)i.push(t.each(e[r],n));return i},cache:function(t){var n={},i=null;return function(r){try{i=n[r]=n[r]||t.call(this,r)}catch(s){i=n[r]=s}if(i instanceof e.Exception)throw i;return i}},any:function(){var t=arguments;return function(n){for(var i=null,r=0;r<t.length;r++)if(null!=t[r]){try{i=t[r].call(this,n)}catch(s){i=null}if(i)return i}throw new e.Exception(n)}},each:function(){var t=arguments;return function(n){for(var i=[],r=null,s=0;s<t.length;s++)if(null!=t[s]){try{r=t[s].call(this,n)}catch(o){throw new e.Exception(n)}i.push(r[0]),n=r[1]}return[i,n]}},all:function(){var e=arguments,t=t;return t.each(t.optional(e))},sequence:function(n,i,r){return i=i||t.rtoken(/^\s*/),r=r||null,1==n.length?n[0]:function(t){for(var s=null,o=null,a=[],u=0;u<n.length;u++){try{s=n[u].call(this,t)}catch(h){break}a.push(s[0]);try{o=i.call(this,s[1])}catch(c){o=null;break}t=o[1]}if(!s)throw new e.Exception(t);if(o)throw new e.Exception(o[1]);if(r)try{s=r.call(this,s[1])}catch(d){throw new e.Exception(s[1])}return[a,s?s[1]:t]}},between:function(e,n,i){i=i||e;var s=t.each(t.ignore(e),n,t.ignore(i));return function(e){var t=s.call(this,e);return[[t[0][0],r[0][2]],t[1]]}},list:function(e,n,i){return n=n||t.rtoken(/^\s*/),i=i||null,e instanceof Array?t.each(t.product(e.slice(0,-1),t.ignore(n)),e.slice(-1),t.ignore(i)):t.each(t.many(t.each(e,t.ignore(n))),px,t.ignore(i))},set:function(n,i,r){return i=i||t.rtoken(/^\s*/),r=r||null,function(s){for(var o=null,a=null,u=null,h=null,c=[[],s],d=!1,l=0;l<n.length;l++){u=null,a=null,o=null,d=1==n.length;try{o=n[l].call(this,s)}catch(f){continue}if(h=[[o[0]],o[1]],o[1].length>0&&!d)try{u=i.call(this,o[1])}catch(m){d=!0}else d=!0;if(d||0!==u[1].length||(d=!0),!d){for(var y=[],g=0;g<n.length;g++)l!=g&&y.push(n[g]);a=t.set(y,i).call(this,u[1]),a[0].length>0&&(h[0]=h[0].concat(a[0]),h[1]=a[1])}if(h[1].length<c[1].length&&(c=h),0===c[1].length)break}if(0===c[0].length)return c;if(r){try{u=r.call(this,c[1])}catch(p){throw new e.Exception(c[1])}c[1]=u[1]}return c}},forward:function(e,t){return function(n){return e[t].call(this,n)}},replace:function(e,t){return function(n){var i=e.call(this,n);return[t,i[1]]}},process:function(e,t){return function(n){var i=e.call(this,n);return[t.call(this,i[0]),i[1]]}},min:function(t,n){return function(i){var r=n.call(this,i);if(r[0].length<t)throw new e.Exception(i);return r}}},n=function(e){return function(){var t=null,n=[];if(arguments.length>1?t=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&(t=arguments[0]),!t)return e.apply(null,arguments);for(var i=0,r=t.shift();i<r.length;i++)return t.unshift(r[i]),n.push(e.apply(null,t)),t.shift(),n}},i="optional not ignore cache".split(/\s/),s=0;s<i.length;s++)t[i[s]]=n(t[i[s]]);for(var o=function(e){return function(){return arguments[0]instanceof Array?e.apply(null,arguments[0]):e.apply(null,arguments)}},a="each any all".split(/\s/),u=0;u<a.length;u++)t[a[u]]=o(t[a[u]])}(),function(){var e=Date,t=(e.prototype,e.CultureInfo),n=function(e){for(var t=[],i=0;i<e.length;i++)e[i]instanceof Array?t=t.concat(n(e[i])):e[i]&&t.push(e[i]);return t};e.Grammar={},e.Translator={hour:function(e){return function(){this.hour=Number(e)}},minute:function(e){return function(){this.minute=Number(e)}},second:function(e){return function(){this.second=Number(e)}},meridian:function(e){return function(){this.meridian=e.slice(0,1).toLowerCase()}},timezone:function(e){return function(){var t=e.replace(/[^\d\+\-]/g,"");t.length?this.timezoneOffset=Number(t):this.timezone=e.toLowerCase()}},day:function(e){var t=e[0];return function(){this.day=Number(t.match(/\d+/)[0])}},month:function(e){return function(){this.month=3==e.length?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(e)/4:Number(e)-1}},year:function(e){return function(){var n=Number(e);this.year=e.length>2?n:n+(n+2e3<t.twoDigitYearMax?2e3:1900)}},rday:function(e){return function(){switch(e){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0,this.now=!0}}},finishExact:function(t){t=t instanceof Array?t:[t];for(var n=0;n<t.length;n++)t[n]&&t[n].call(this);var i=new Date;if(!this.hour&&!this.minute||this.month||this.year||this.day||(this.day=i.getDate()),this.year||(this.year=i.getFullYear()),this.month||0===this.month||(this.month=i.getMonth()),this.day||(this.day=1),this.hour||(this.hour=0),this.minute||(this.minute=0),this.second||(this.second=0),this.meridian&&this.hour&&("p"==this.meridian&&this.hour<12?this.hour=this.hour+12:"a"==this.meridian&&12==this.hour&&(this.hour=0)),this.day>e.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");var r=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);return this.timezone?r.set({timezone:this.timezone}):this.timezoneOffset&&r.set({timezoneOffset:this.timezoneOffset}),r},finish:function(t){if(t=t instanceof Array?n(t):[t],0===t.length)return null;for(var i=0;i<t.length;i++)"function"==typeof t[i]&&t[i].call(this);var r=e.today();if(this.now&&!this.unit&&!this.operator)return new Date;this.now&&(r=new Date);var s,o,a,u=!!(this.days&&null!==this.days||this.orient||this.operator);if(a="past"==this.orient||"subtract"==this.operator?-1:1,this.now||-1=="hour minute second".indexOf(this.unit)||r.setTimeToNow(),(this.month||0===this.month)&&-1!="year day hour minute second".indexOf(this.unit)&&(this.value=this.month+1,this.month=null,u=!0),!u&&this.weekday&&!this.day&&!this.days){var h=Date[this.weekday]();this.day=h.getDate(),this.month||(this.month=h.getMonth()),this.year=h.getFullYear()}if(u&&this.weekday&&"month"!=this.unit&&(this.unit="day",s=e.getDayNumberFromName(this.weekday)-r.getDay(),o=7,this.days=s?(s+a*o)%o:a*o),this.month&&"day"==this.unit&&this.operator&&(this.value=this.month+1,this.month=null),null!=this.value&&null!=this.month&&null!=this.year&&(this.day=1*this.value),this.month&&!this.day&&this.value&&(r.set({day:1*this.value}),u||(this.day=1*this.value)),this.month||!this.value||"month"!=this.unit||this.now||(this.month=this.value,u=!0),u&&(this.month||0===this.month)&&"year"!=this.unit&&(this.unit="month",s=this.month-r.getMonth(),o=12,this.months=s?(s+a*o)%o:a*o,this.month=null),this.unit||(this.unit="day"),!this.value&&this.operator&&null!==this.operator&&this[this.unit+"s"]&&null!==this[this.unit+"s"]?this[this.unit+"s"]=this[this.unit+"s"]+("add"==this.operator?1:-1)+(this.value||0)*a:(null==this[this.unit+"s"]||null!=this.operator)&&(this.value||(this.value=1),this[this.unit+"s"]=this.value*a),this.meridian&&this.hour&&("p"==this.meridian&&this.hour<12?this.hour=this.hour+12:"a"==this.meridian&&12==this.hour&&(this.hour=0)),this.weekday&&!this.day&&!this.days){var h=Date[this.weekday]();this.day=h.getDate(),h.getMonth()!==r.getMonth()&&(this.month=h.getMonth())}return!this.month&&0!==this.month||this.day||(this.day=1),this.orient||this.operator||"week"!=this.unit||!this.value||this.day||this.month?(u&&this.timezone&&this.day&&this.days&&(this.day=this.days),u?r.add(this):r.set(this)):Date.today().setWeek(this.value)}};var i,r=e.Parsing.Operators,s=e.Grammar,o=e.Translator;s.datePartDelimiter=r.rtoken(/^([\s\-\.\,\/\x27]+)/),s.timePartDelimiter=r.stoken(":"),s.whiteSpace=r.rtoken(/^\s*/),s.generalDelimiter=r.rtoken(/^(([\s\,]|at|@|on)+)/);var a={};s.ctoken=function(e){var n=a[e];if(!n){for(var i=t.regexPatterns,s=e.split(/\s+/),o=[],u=0;u<s.length;u++)o.push(r.replace(r.rtoken(i[s[u]]),s[u]));n=a[e]=r.any.apply(null,o)}return n},s.ctoken2=function(e){return r.rtoken(t.regexPatterns[e])},s.h=r.cache(r.process(r.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),o.hour)),s.hh=r.cache(r.process(r.rtoken(/^(0[0-9]|1[0-2])/),o.hour)),s.H=r.cache(r.process(r.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),o.hour)),s.HH=r.cache(r.process(r.rtoken(/^([0-1][0-9]|2[0-3])/),o.hour)),s.m=r.cache(r.process(r.rtoken(/^([0-5][0-9]|[0-9])/),o.minute)),s.mm=r.cache(r.process(r.rtoken(/^[0-5][0-9]/),o.minute)),s.s=r.cache(r.process(r.rtoken(/^([0-5][0-9]|[0-9])/),o.second)),s.ss=r.cache(r.process(r.rtoken(/^[0-5][0-9]/),o.second)),s.hms=r.cache(r.sequence([s.H,s.m,s.s],s.timePartDelimiter)),s.t=r.cache(r.process(s.ctoken2("shortMeridian"),o.meridian)),s.tt=r.cache(r.process(s.ctoken2("longMeridian"),o.meridian)),s.z=r.cache(r.process(r.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),o.timezone)),s.zz=r.cache(r.process(r.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),o.timezone)),s.zzz=r.cache(r.process(s.ctoken2("timezone"),o.timezone)),s.timeSuffix=r.each(r.ignore(s.whiteSpace),r.set([s.tt,s.zzz])),s.time=r.each(r.optional(r.ignore(r.stoken("T"))),s.hms,s.timeSuffix),s.d=r.cache(r.process(r.each(r.rtoken(/^([0-2]\d|3[0-1]|\d)/),r.optional(s.ctoken2("ordinalSuffix"))),o.day)),s.dd=r.cache(r.process(r.each(r.rtoken(/^([0-2]\d|3[0-1])/),r.optional(s.ctoken2("ordinalSuffix"))),o.day)),s.ddd=s.dddd=r.cache(r.process(s.ctoken("sun mon tue wed thu fri sat"),function(e){return function(){this.weekday=e}})),s.M=r.cache(r.process(r.rtoken(/^(1[0-2]|0\d|\d)/),o.month)),s.MM=r.cache(r.process(r.rtoken(/^(1[0-2]|0\d)/),o.month)),s.MMM=s.MMMM=r.cache(r.process(s.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),o.month)),s.y=r.cache(r.process(r.rtoken(/^(\d\d?)/),o.year)),s.yy=r.cache(r.process(r.rtoken(/^(\d\d)/),o.year)),s.yyy=r.cache(r.process(r.rtoken(/^(\d\d?\d?\d?)/),o.year)),s.yyyy=r.cache(r.process(r.rtoken(/^(\d\d\d\d)/),o.year)),i=function(){return r.each(r.any.apply(null,arguments),r.not(s.ctoken2("timeContext")))},s.day=i(s.d,s.dd),s.month=i(s.M,s.MMM),s.year=i(s.yyyy,s.yy),s.orientation=r.process(s.ctoken("past future"),function(e){return function(){this.orient=e}}),s.operator=r.process(s.ctoken("add subtract"),function(e){return function(){this.operator=e}}),s.rday=r.process(s.ctoken("yesterday tomorrow today now"),o.rday),s.unit=r.process(s.ctoken("second minute hour day week month year"),function(e){return function(){this.unit=e}}),s.value=r.process(r.rtoken(/^\d\d?(st|nd|rd|th)?/),function(e){return function(){this.value=e.replace(/\D/g,"")}}),s.expression=r.set([s.rday,s.operator,s.value,s.unit,s.orientation,s.ddd,s.MMM]),i=function(){return r.set(arguments,s.datePartDelimiter)},s.mdy=i(s.ddd,s.month,s.day,s.year),s.ymd=i(s.ddd,s.year,s.month,s.day),s.dmy=i(s.ddd,s.day,s.month,s.year),s.date=function(e){return(s[t.dateElementOrder]||s.mdy).call(this,e)},s.format=r.process(r.many(r.any(r.process(r.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(t){if(s[t])return s[t];throw e.Parsing.Exception(t)}),r.process(r.rtoken(/^[^dMyhHmstz]+/),function(e){return r.ignore(r.stoken(e))}))),function(e){return r.process(r.each.apply(null,e),o.finishExact)});var u={},h=function(e){return u[e]=u[e]||s.format(e)[0]};s.formats=function(e){if(e instanceof Array){for(var t=[],n=0;n<e.length;n++)t.push(h(e[n]));return r.any.apply(null,t)}return h(e)},s._formats=s.formats(['"yyyy-MM-ddTHH:mm:ssZ"',"yyyy-MM-ddTHH:mm:ssZ","yyyy-MM-ddTHH:mm:ssz","yyyy-MM-ddTHH:mm:ss","yyyy-MM-ddTHH:mmZ","yyyy-MM-ddTHH:mmz","yyyy-MM-ddTHH:mm","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy","d"]),s._start=r.process(r.set([s.date,s.time,s.expression],s.generalDelimiter,s.whiteSpace),o.finish),s.start=function(e){try{var t=s._formats.call({},e);if(0===t[1].length)return t}catch(n){}return s._start.call({},e)},e._parse=e.parse,e.parse=function(t){var n=null;if(!t)return null;
if(t instanceof Date)return t;try{n=e.Grammar.start.call({},t.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"))}catch(i){return null}return 0===n[1].length?n[0]:null},e.getParseFunction=function(t){var n=e.Grammar.formats(t);return function(e){var t=null;try{t=n.call({},e)}catch(i){return null}return 0===t[1].length?t[0]:null}},e.parseExact=function(t,n){return e.getParseFunction(n)(t)}}(),RequireJS.define("date",function(e){return function(){var t;return t||e.Date}}(this)),function(){RequireJS.define("js/discovery/views/course_card",["jquery","underscore","backbone","gettext","date"],function(e,t,n,i,r){function s(e){return o(e).toString("MMM dd, yyyy")}function o(e){return new r(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds())}return n.View.extend({tagName:"li",templateId:"#course_card-tpl",className:"courses-listing-item",initialize:function(){this.tpl=t.template(e(this.templateId).html())},render:function(){var e=t.clone(this.model.attributes);return e.start=s(new r(e.start)),e.enrollment_start=s(new r(e.enrollment_start)),this.$el.html(this.tpl(e)),this}})})}(define||RequireJS.define),function(){RequireJS.define("js/discovery/views/courses_listing",["jquery","underscore","backbone","gettext","js/discovery/views/course_card"],function(e,t,n,i,r){return n.View.extend({el:"div.courses",$window:e(window),$document:e(document),initialize:function(){this.$list=this.$el.find(".courses-listing"),this.attachScrollHandler()},render:function(){return this.$list.empty(),this.renderItems(),this},renderNext:function(){this.renderItems(),this.isLoading=!1},renderItems:function(){var e=this.model.latest(),t=e.map(function(e){var t=new r({model:e});return t.render().el},this);this.$list.append(t)},attachScrollHandler:function(){this.$window.on("scroll",t.throttle(this.scrollHandler.bind(this),400))},scrollHandler:function(){this.isNearBottom()&&!this.isLoading&&(this.trigger("next"),this.isLoading=!0)},isNearBottom:function(){var e=this.$window.scrollTop()+this.$window.height(),t=this.$document.height()-200;return e>=t}})})}(define||RequireJS.define),function(){RequireJS.define("js/discovery/views/filter_label",["jquery","underscore","backbone","gettext"],function(e,t,n){return n.View.extend({tagName:"li",templateId:"#filter-tpl",className:"active-filter",initialize:function(){this.tpl=t.template(e("#filter-tpl").html()),this.listenTo(this.model,"remove",this.remove),this.listenTo(this.model,"change",this.render)},render:function(){var e=t.clone(this.model.attributes);return e.name=e.name||e.query,this.className=e.type,this.$el.html(this.tpl(e)),this}})})}(define||RequireJS.define),function(){RequireJS.define("js/discovery/views/filter_bar",["jquery","underscore","backbone","gettext","js/discovery/models/filter","js/discovery/views/filter_label"],function(e,t,n,i,r,s){return n.View.extend({el:"#filter-bar",templateId:"#filter_bar-tpl",events:{"click #clear-all-filters":"clearAll","click li .discovery-button":"clearFilter"},initialize:function(){this.tpl=t.template(e(this.templateId).html()),this.render(),this.listenTo(this.collection,"remove",this.hideIfEmpty),this.listenTo(this.collection,"add",this.addFilter),this.listenTo(this.collection,"reset",this.resetFilters)},render:function(){return this.$el.html(this.tpl()),this.$ul=this.$el.find("ul"),this.$el.addClass("is-animated"),this},addFilter:function(e){var t=new s({model:e});this.$ul.append(t.render().el),this.show()},hideIfEmpty:function(){this.collection.isEmpty()&&this.hide()},resetFilters:function(){this.$ul.empty(),this.hide()},clearFilter:function(t){var n=e(t.currentTarget),i=this.collection.get(n.data("type"));this.trigger("clearFilter",i.id)},clearAll:function(){this.trigger("clearAll")},show:function(){this.$el.removeClass("is-collapsed")},hide:function(){this.$ul.empty(),this.$el.addClass("is-collapsed")}})})}(define||RequireJS.define),function(){RequireJS.define("js/discovery/views/refine_sidebar",["jquery","underscore","backbone","edx-ui-toolkit/js/utils/html-utils"],function(e,t,n,i){return n.View.extend({el:".search-facets",events:{"click li button":"selectOption","click .show-less":"collapse","click .show-more":"expand"},initialize:function(t){this.meanings=t.meanings||{},this.$container=this.$el.find(".search-facets-lists"),this.facetTpl=i.template(e("#facet-tpl").html()),this.facetOptionTpl=i.template(e("#facet_option-tpl").html())},facetName:function(e){return this.meanings[e]&&this.meanings[e].name||e},termName:function(e,t){return this.meanings[e]&&this.meanings[e].terms&&this.meanings[e].terms[t]||t},renderOptions:function(e){return i.joinHtml.apply(this,t.map(e,function(e){var n=t.clone(e.attributes);return n.name=this.termName(n.facet,n.term),this.facetOptionTpl(n)},this))},renderFacet:function(e,t){return this.facetTpl({name:e,displayName:this.facetName(e),optionsHtml:this.renderOptions(t),listIsHuge:t.length>9})},render:function(){var e=this.collection.groupBy("facet"),n=i.joinHtml.apply(this,t.map(e,function(e,t){return e.length>0?this.renderFacet(t,e):void 0},this));return i.setHtml(this.$container,n),this},collapse:function(t){var n=e(t.currentTarget),i=n.siblings(".show-more"),r=n.parent().siblings("ul");r.addClass("collapse"),n.addClass("hidden"),i.removeClass("hidden")},expand:function(t){var n=e(t.currentTarget),i=n.parent("div").siblings("ul");n.addClass("hidden"),i.removeClass("collapse"),n.siblings(".show-less").removeClass("hidden")},selectOption:function(t){var n=e(t.currentTarget);this.trigger("selectOption",n.data("facet"),n.data("value"),n.data("text"))}})})}(define||RequireJS.define),function(){RequireJS.define("js/discovery/discovery_factory",["backbone","js/discovery/models/search_state","js/discovery/collections/filters","js/discovery/views/search_form","js/discovery/views/courses_listing","js/discovery/views/filter_bar","js/discovery/views/refine_sidebar"],function(e,t,n,i,r,s,o){return function(a,u){function h(e){y.showLoadingIndicator(),f.remove(e),"search_query"===e?y.doSearch(""):l.refineSearch(f.getTerms())}function c(e){return'"'+e+'"'}var d=_.extend({},e.Events),l=new t,f=new n,m=new r({model:l.discovery}),y=new i,g=new s({collection:f}),p=new o({collection:l.discovery.facetOptions,meanings:a});d.listenTo(y,"search",function(e){f.reset(),y.showLoadingIndicator(),l.performSearch(e,f.getTerms())}),d.listenTo(p,"selectOption",function(e,t,n){y.showLoadingIndicator(),f.get(e)?h(e):(f.add({type:e,query:t,name:n}),l.refineSearch(f.getTerms()))}),d.listenTo(g,"clearFilter",h),d.listenTo(g,"clearAll",function(){y.doSearch("")}),d.listenTo(m,"next",function(){l.loadNextPage()}),d.listenTo(l,"next",function(){m.renderNext()}),d.listenTo(l,"search",function(e,t){t>0?(y.showFoundMessage(t),e&&f.add({type:"search_query",query:e,name:c(e)},{merge:!0})):(y.showNotFoundMessage(e),f.reset()),y.hideLoadingIndicator(),m.render(),p.render()}),d.listenTo(l,"error",function(){y.showErrorMessage(),y.hideLoadingIndicator()}),y.doSearch(u)}})}(define||RequireJS.define);